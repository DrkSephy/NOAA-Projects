<!DOCTYPE html>

<head>
  <meta charset="utf-8">

  <style>
    .stop {
      fill: #C83D2D;
      stroke: #C83D2D;
      stroke-width: 0.01px;
    }

    .stop.active {
      stroke-width: 0.05px;
    }

    .voronoi-stops {
      fill: transparent;
      stroke-width: 0.001;
      stroke: #676767;
    }

    .text-tooltip {
      position: absolute;
      top: 0;
      right: 0;
      margin: 1em 1em 0 0;
      padding: 1em;
      font-size: 1.5em;
      background-color: #F2F2F2;
      border: 1px solid #222222;
    }
  </style>
</head>

<body>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>

  <script> 

    d3.json('granule-data.json', function(error, json){
      //console.log(json.data[0].IMAGE)
      var width = 878;
      var height = 500;

      var svg = d3.select('body').append('svg')
        .attr('width', width)
        .attr('height', height);

      var projectionData = json;
      var centroid = d3.geo.centroid(projectionData);
      var projection = d3.geo.albersUsa().scale(1000);
      var projectionPath = d3.geo.path().projection(projection)
          .pointRadius(function(d) { console.log(d); return 0.002; });

      // Create group for features
      var featureGroup = svg.append('g').attr('class', 'feature-group');
      // Add data
      featureGroup.selectAll('.stop')
        .data(json.data)
        .enter().append('path')
        .attr('class', 'stop')
        .attr('d', function(d){
          d.stopPath = this;
          return projectionPath(d); 
          
          //console.log(d);
          //console.log(projectionPath(d))
        });


      // Make Voronoi map for hovering over stop
      var text = d3.select('body').append('div').attr('class', 'text-tooltip');

      var voronoiStops = d3.geom.voronoi()
        .x(function(d) { console.log(d); return d.LONGITUDE; })
        .y(function(d) { return d.LATITUDE; })
        .clipExtent([[0, 0], [width, height]]);

      featureGroup.selectAll('.voronoi-stops')
        .data(voronoiStops(json.data))
        .enter().append('path')
          .attr('class', 'voronoi-stops')
          .attr('d', function(d) { return 'M' + d.join('L') + 'Z'; })



    });

  </script>
</body>